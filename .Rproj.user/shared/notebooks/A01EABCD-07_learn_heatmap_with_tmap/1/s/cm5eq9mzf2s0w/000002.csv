"0","# 有人的地圖性質不乖，"
"0","# 應該要是 MULTIPOLYGON，但是有些是 GEOMETRYCOLLECTION。"
"0","# US_cont$geometry %>% sapply(., attr, which = ""class"") %>% c() %>% table"
"0","# US_AK$geometry %>% sapply(., attr, which = ""class"") %>% c() %>% table"
"0",""
"0","# ---"
"0","#############################"
"0","## Figure 11"
"0","#############################"
"0",""
"0","US_cont <- US %>% "
"0","  subset(!STATE %in% c(""02"", ""15"", ""72"")) %>% "
"0","  simplify_shape(shp = ., fact = 0.2) "
"0",""
"0","US_AK <- US %>% "
"0","  subset(STATE == ""02"") %>% "
"0","  simplify_shape(0.2) "
"0",""
"0","US_HI <- US %>% "
"0","  subset(STATE == ""15"") %>% "
"0","  simplify_shape(0.2) "
"0",""
"0","# create state boundaries"
"0","# 製作 boundaries 的方式要學起來"
"0","US_states <- US_cont %>% "
"0","    dplyr::select(geometry) %>% "
"0","    stats::aggregate(by = list(US_cont$STATE), FUN = mean)"
"0",""
"0","US_AK_states <- US_AK %>% "
"0","    dplyr::select(geometry) %>% "
"0","    stats::aggregate(by = list(US_AK$STATE), FUN = mean)"
"0",""
"0","US_HI_states <- US_HI %>% "
"0","    dplyr::select(geometry) %>% "
"0","    stats::aggregate(by = list(US_HI$STATE), FUN = mean)"
"0",""
"0",""
"0","# contiguous US"
"0","# 可以刪除第1259, 2407筆"
"0","m_cont <- tm_shape(US_cont, projection = 2163) +"
"0","  tm_polygons(col = ""PCT_OBESE_ADULTS10"", "
"0","              border.col = ""gray50"", "
"0","              border.alpha = .5, "
"0","              title = """", "
"0","              showNA = TRUE) +"
"0","  "
"0","  tm_shape(US_states) +"
"0","  tm_borders(lwd = 1, col = ""black"", alpha = .5) +"
"0","  tm_credits(text = paste0(""Data @ Unites States Department of Agriculture"","
"0","                           ""\nShape @ Unites States Census Bureau""), #只有在mode=plot才會出現"
"0","             position = c(""right"", ""bottom"")) +"
"0","  "
"0","  tm_layout(title = ""2010 Adult Obesity by County, percent"", "
"0","            title.position = c(""center"", ""top""), "
"0","            legend.position = c(""right"", ""bottom""), "
"0","            frame = FALSE, "
"0","            inner.margins = c(0.1, 0.1, 0.05, 0.05))"
"0","# tmap_mode(mode = ""plot"")"
"0","# m_cont"
"0",""
"0",""
"0","# Alaska inset0"
"0","# 因為一些錯誤，所以要加上state邊界。不然就要扣除第24筆。"
"0","m_AK <- tm_shape(US_AK, projection = 3338) +"
"0","  tm_polygons(col = ""PCT_OBESE_ADULTS10"", "
"0","              border.col = ""gray50"", border.alpha = .5, "
"0","              breaks = seq(10, 50, by = 5)) + "
"0","  "
"0","  tm_shape(shp = US_AK_states) +"
"0","  tm_borders(lwd = 1, col = ""black"", alpha = .5) +"
"0","  "
"0","  tm_layout(title = ""Alaska"", "
"0","            title.size = 0.8, "
"0","            legend.show = FALSE, "
"0","            bg.color = NA, "
"0","            frame = FALSE)"
"0","# tmap_mode(mode = ""plot"")"
"0","# m_AK"
"0",""
"0",""
"0","# Hawaii inset"
"0","m_HI <- tm_shape(US_HI, projection = 3759) +"
"0","  tm_polygons(""PCT_OBESE_ADULTS10"", "
"0","              border.col = ""gray50"", "
"0","              border.alpha = .5, "
"0","              breaks = seq(10, 50, by = 5)) +"
"0","  "
"0","  tm_shape(shp = US_HI_states) +"
"0","  tm_borders(lwd = 1, col = ""black"", alpha = .5) +"
"0","  "
"0","  tm_layout(title = ""Hawaii"", legend.show = FALSE, "
"0","            bg.color = NA, "
"0","            title.position = c(""LEFT"", ""BOTTOM""), "
"0","            title.size = 0.8, frame = FALSE)"
"0","# tmap_mode(mode = ""plot"")"
"0","# m_HI"
"0",""
"0",""
"0","# specify viewports for Alaska and Hawaii"
"0","# 原點(0,0)在左下角"
"0","library(""grid"")"
"0","vp_AK <- viewport(x = 0.15, y = 0.15, width = 0.3, height = 0.3)"
"0","vp_HI <- viewport(x = 0.4, y = 0.1, width = 0.2, height = 0.1)"
"0",""
"0","# save map"
"0","tmap_mode(""plot"")"
"0","tmap_save(tm = m_cont, filename = ""../data/USchoro.png"", "
"0","          scale = 0.7, width = 6.125, outer.margins = 0,"
"0","          insets_tm = list(m_AK, m_HI), "
"0","          insets_vp = list(vp_AK, vp_HI))"
"0",""
