"0","#############################"
"0","## Figure 9"
"0","#############################"
"0","library(""readxl"")"
"0","library(""grid"")"
"0",""
"0","# function to obtain Food Environment Atlas data (2014)"
"0","get_food_envir_data <- function() {"
"0","  dir <- tempdir()"
"0","  if (!file.exists(file.path(dir, ""DataDownload.xls""))) {"
"0","    download.file(""https://www.ers.usda.gov/webdocs/DataFiles/48731/February2014.xls?v=41688"", "
"0","                  destfile = file.path(dir, ""DataDownload.xls""), mode = ""wb"")"
"0","  }"
"0","  res <- tryCatch({"
"0","    read_excel(file.path(dir, ""DataDownload.xls""), sheet = ""HEALTH"")    "
"0","  }, error = function(e) {"
"0","    stop(""The excel file cannot be read. Please open it, and remove all sheets except HEALTH. The location of the file is: "", normalizePath(file.path(dir, ""DataDownload.xls"")))"
"0","  })"
"0","}"
"0",""
"0","# function to obtain US county shape"
"0","get_US_county_2010_shape <- function() {"
"0","  dir <- tempdir()"
"0","  download.file(""http://www2.census.gov/geo/tiger/GENZ2010/gz_2010_us_050_00_20m.zip"", "
"0","                destfile = file.path(dir, ""gz_2010_us_050_00_20m.zip""))"
"0","  unzip(file.path(dir, ""gz_2010_us_050_00_20m.zip""), exdir = dir)"
"0","  US <- sf::read_sf(file.path(dir, ""gz_2010_us_050_00_20m.shp""))"
"0","  levels(US$NAME) <- iconv(levels(US$NAME), from = ""latin1"", to = ""utf8"")"
"0","  US"
"0","}"
"0",""
"0","# obtain Food Environment Atlas data"
"0","# FEA <- get_food_envir_data()"
"0","FEA <- read_excel(""../data/DataDownload.xls"", sheet = ""HEALTH"")"
"0",""
"0","# obtain US county shape"
"0","# US <- get_US_county_2010_shape()"
"0","US <- sf::read_sf(""../data/gz_2010_us_050_00_20m/gz_2010_us_050_00_20m.shp"")"
"0","levels(US$NAME) <- iconv(levels(US$NAME), from = ""latin1"", to = ""utf8"")"
"0",""
"0","# ---"
"0","us1 <- qtm(shp = US)"
"0",""
"0","us1"
